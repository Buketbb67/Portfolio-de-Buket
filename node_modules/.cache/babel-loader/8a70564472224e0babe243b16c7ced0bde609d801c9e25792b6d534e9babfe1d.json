{"ast":null,"code":"import _defineProperty from \"/home/buket-b/Portfolio/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nconst NUMBER_REGEX = /^\\d*(\\.\\d+)?$/;\nconst MUTATION_OBSERVER_CONFIG = {\n  attributes: true,\n  childList: false,\n  subtree: false\n};\n/**\n * Sequence player.\n *\n * Example usage:\n * ```html\n * <lord-icon trigger=\"sequence\" sequence=\"state:intro-empty,play,state:hover-empty,play,state:morph-fill,play,state:morph-erase,play,state:intro-empty,delay:first:last:500,play:reverse\" src=\"/trash.json\"></lord-icon>\n * ```\n */\nexport class Sequence {\n  constructor(element, targetElement, player) {\n    _defineProperty(this, \"element\", void 0);\n    _defineProperty(this, \"targetElement\", void 0);\n    _defineProperty(this, \"player\", void 0);\n    _defineProperty(this, \"sequenceIndex\", 0);\n    _defineProperty(this, \"frameState\", null);\n    _defineProperty(this, \"frameDelayFirst\", null);\n    _defineProperty(this, \"frameDelayLast\", null);\n    _defineProperty(this, \"timer\", void 0);\n    _defineProperty(this, \"observer\", void 0);\n    this.element = element;\n    this.targetElement = targetElement;\n    this.player = player;\n    this.observer = new MutationObserver((mutationList, observer) => {\n      for (const mutation of mutationList) {\n        if (mutation.type === \"attributes\" && mutation.attributeName === 'sequence') {\n          this.reset();\n          this.step();\n        }\n      }\n    });\n  }\n  onReady() {\n    this.step();\n  }\n  onComplete() {\n    this.timer = setTimeout(() => {\n      this.timer = null;\n      this.frameDelayLast = null;\n      this.step();\n    }, this.frameDelayLast || 0);\n  }\n  onConnected() {\n    this.observer.observe(this.element, MUTATION_OBSERVER_CONFIG);\n  }\n  onDisconnected() {\n    this.observer.disconnect();\n    if (this.timer) {\n      clearTimeout(this.timer);\n      this.timer = null;\n    }\n  }\n  reset() {\n    this.player.pause();\n    this.sequenceIndex = 0;\n    this.frameState = this.frameDelayFirst = this.frameDelayLast = null;\n    if (this.timer) {\n      clearTimeout(this.timer);\n      this.timer = null;\n    }\n  }\n  takeStep() {\n    const steps = this.sequence.split(',');\n    const step = steps[this.sequenceIndex];\n    this.sequenceIndex++;\n    if (this.sequenceIndex >= steps.length) {\n      this.sequenceIndex = 0;\n    }\n    const [action, ...params] = step.split(':');\n    return {\n      action,\n      params\n    };\n  }\n  handleStep(action, params) {\n    if (action === 'play') {\n      if (this.frameState) {\n        this.player.state = this.frameState;\n        this.frameState = null;\n      }\n      const hasReverse = params.includes('reverse');\n      if (hasReverse) {\n        this.player.goToLastFrame();\n        this.player.direction = -1;\n      } else {\n        this.player.goToFirstFrame();\n        this.player.direction = 1;\n      }\n      this.timer = setTimeout(() => {\n        this.timer = null;\n        this.frameDelayFirst = null;\n        this.player.play();\n      }, this.frameDelayFirst || 0);\n    } else if (action === 'frame') {\n      let frameIndex = 0;\n      if (params.length && params[0].match(NUMBER_REGEX)) {\n        frameIndex = Math.max(0, Math.min(this.player.frames, +params[0]));\n      }\n      this.player.frame = frameIndex;\n      this.timer = setTimeout(() => {\n        this.timer = null;\n        this.frameDelayFirst = null;\n        this.step();\n      }, this.frameDelayFirst || 0);\n    } else if (action === 'state') {\n      this.frameState = params[0];\n      this.step();\n    } else if (action === 'delay') {\n      let value = null;\n      for (const param of params) {\n        if (param && param.match(NUMBER_REGEX)) {\n          value = +param;\n        }\n      }\n      if (value && value > 0) {\n        if (params.includes('first') && params.includes('last')) {\n          this.frameDelayFirst = value;\n          this.frameDelayLast = value;\n        } else if (params.includes('first')) {\n          this.frameDelayFirst = value;\n        } else if (params.includes('last')) {\n          this.frameDelayLast = value;\n        } else {\n          this.frameDelayFirst = value;\n        }\n      }\n      this.step();\n    } else if (action === 'idle') {\n      // do nothing\n    } else {\n      throw new Error(\"Invalid sequence action: \".concat(action));\n    }\n  }\n  step() {\n    const {\n      action,\n      params\n    } = this.takeStep();\n    if (!action) {\n      return;\n    }\n    this.handleStep(action, params);\n  }\n  get sequence() {\n    return this.element.getAttribute('sequence') || '';\n  }\n}","map":{"version":3,"names":["NUMBER_REGEX","MUTATION_OBSERVER_CONFIG","attributes","childList","subtree","Sequence","constructor","element","targetElement","player","_defineProperty","observer","MutationObserver","mutationList","mutation","type","attributeName","reset","step","onReady","onComplete","timer","setTimeout","frameDelayLast","onConnected","observe","onDisconnected","disconnect","clearTimeout","pause","sequenceIndex","frameState","frameDelayFirst","takeStep","steps","sequence","split","length","action","params","handleStep","state","hasReverse","includes","goToLastFrame","direction","goToFirstFrame","play","frameIndex","match","Math","max","min","frames","frame","value","param","Error","concat","getAttribute"],"sources":["../../src/triggers/sequence.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}